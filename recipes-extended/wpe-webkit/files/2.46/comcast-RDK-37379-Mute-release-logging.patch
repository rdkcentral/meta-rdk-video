From 95f4f0fcd3c099de1eb56e12bf405333a6b4bd65 Mon Sep 17 00:00:00 2001
From: Andrzej Surdej <Andrzej_Surdej@comcast.com>
Date: Thu, 28 Jul 2022 08:47:19 +0000
Subject: [PATCH] comcast - RDK-37379 - Mute release logging

Hide release logging under WEBKIT_DEBUG env
so it is muted by default.
This significantly reduces default WebKit logging
with "release logging" enabled
---
 Source/WTF/wtf/Logger.h | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/Source/WTF/wtf/Logger.h b/Source/WTF/wtf/Logger.h
index 9f0de7bc2bdf..3efb896f66fc 100644
--- a/Source/WTF/wtf/Logger.h
+++ b/Source/WTF/wtf/Logger.h
@@ -253,6 +253,19 @@ public:
         logVerbose(channel, WTFLogLevel::Debug, file, function, line, arguments...);
     }
 
+    inline bool alwaysLogAllowed() const {
+        static const bool isAlwaysLogAllowed = []() {
+            // Put all "always/release logging" behind WEBKIT_DEBUG env.
+            // Muted by default.
+            const auto* webkit_debug_env = getenv("WEBKIT_DEBUG");
+            if (webkit_debug_env && strlen(webkit_debug_env))
+                return true;
+            return false;
+        }();
+
+        return isAlwaysLogAllowed;
+    }
+
     template<typename... Argument>
     inline bool willLog(const WTFLogChannel& channel, WTFLogLevel level, const Argument&... arguments) const
     {
@@ -273,6 +286,9 @@ public:
             return false;
 #endif
 
+        if (level <= WTFLogLevel::Always)
+            return alwaysLogAllowed();
+
         if (level <= WTFLogLevel::Error)
             return true;
 
-- 
2.48.1

