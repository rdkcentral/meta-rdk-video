From 0efc1333593ec533edfabdd61314e5d5745eea9b Mon Sep 17 00:00:00 2001
From: Andrzej Surdej <Andrzej_Surdej@comcast.com>
Date: Thu, 11 Sep 2025 10:37:16 +0200
Subject: [PATCH] comcast - DELIA-59087 - Disable pausing playback for
 buffering

---
 .../graphics/gstreamer/MediaPlayerPrivateGStreamer.cpp | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/Source/WebCore/platform/graphics/gstreamer/MediaPlayerPrivateGStreamer.cpp b/Source/WebCore/platform/graphics/gstreamer/MediaPlayerPrivateGStreamer.cpp
index d7ce4529b06c..60cd3762c7cc 100644
--- a/Source/WebCore/platform/graphics/gstreamer/MediaPlayerPrivateGStreamer.cpp
+++ b/Source/WebCore/platform/graphics/gstreamer/MediaPlayerPrivateGStreamer.cpp
@@ -2437,6 +2437,9 @@ void MediaPlayerPrivateGStreamer::updateBufferingStatus(GstBufferingMode mode, d
         m_fillTimer.startRepeating(200_ms);
     }
 
+    // Force buffering flag to be always false so we don't enter buffering state at all
+    m_isBuffering = false;
+
     m_bufferingPercentage = percentage;
 
     // resetHistory is used to forget about the past values and set them like the new ones. This is useful when resetting
@@ -3382,6 +3385,13 @@ void MediaPlayerPrivateGStreamer::createGSTPlayBin(const URL& url)
         gst_element_set_start_time(m_pipeline.get(), GST_CLOCK_TIME_NONE);
     }
 
+    if (!isMediaSource() && !isMediaStream) { // for progressive playback only
+        // set fixed playbin buffer-size to disable uridecodebin estimations
+        // that could be platform dependent. Use default queue2 elem max size value
+        static constexpr gint kDefaultQueue2BufferSize = 2 * 1024 * 1024;   // Default queue2 size - 2 MB
+        g_object_set(G_OBJECT(pipeline()), "buffer-size", kDefaultQueue2BufferSize, nullptr);
+    }
+
     setStreamVolumeElement(GST_STREAM_VOLUME(m_pipeline.get()));
 
     GST_INFO_OBJECT(pipeline(), "Using legacy playbin element: %s", boolForPrinting(m_isLegacyPlaybin));
-- 
2.48.1

