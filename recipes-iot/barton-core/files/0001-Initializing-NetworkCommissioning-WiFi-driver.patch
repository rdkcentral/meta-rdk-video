From ad386154ca9cc3e9da2075b9859c811899db9efe Mon Sep 17 00:00:00 2001
From: Tanuj <Tanuj_Sharma@comcast.com>
Date: Wed, 14 Jan 2026 13:08:04 +0530
Subject: [PATCH] Initializing NetworkCommissioning WiFi driver

---
 core/src/subsystems/matter/Matter.cpp | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/core/src/subsystems/matter/Matter.cpp b/core/src/subsystems/matter/Matter.cpp
index def83bc..90eb162 100644
--- a/core/src/subsystems/matter/Matter.cpp
+++ b/core/src/subsystems/matter/Matter.cpp
@@ -78,6 +78,7 @@ extern "C" {
 #include <setup_payload/QRCodeSetupPayloadGenerator.h>
 #include <setup_payload/SetupPayload.h>
 #include <transport/SessionMessageDelegate.h>
+#include <platform/Linux/NetworkCommissioningDriver.h>
 
 #include <lib/support/TestGroupData.h>
 
@@ -146,6 +147,8 @@ namespace
     std::unique_ptr<ThreadBorderRouterManagementDelegate> otbrDelegate;
     std::optional<ThreadBorderRouterManagement::ServerInstance> threadBorderRouterManagementServer;
     EndpointId threadBorderRouterManagementServerEndpointId = UINT16_MAX;
+    chip::DeviceLayer::NetworkCommissioning::LinuxWiFiDriver * sLinuxWiFiDriver = nullptr;
+    chip::app::Clusters::NetworkCommissioning::Instance * sNetworkCommissioningInstance = nullptr;
 } // namespace
 
 Matter::Matter() : groupDataProvider(kMaxGroupsPerFabric, kMaxGroupKeysPerFabric)
@@ -1446,3 +1449,17 @@ void emberAfThreadBorderRouterManagementClusterInitCallback(EndpointId endpoint)
         threadBorderRouterManagementServerEndpointId = endpoint;
     }
 }
+
+void emberAfNetworkCommissioningClusterInitCallback(EndpointId endpoint)
+{
+    if (sNetworkCommissioningInstance != nullptr)
+    {
+        icDebug("NetworkCommissioning already initialized for endpoint %u", endpoint);
+        return;
+    }
+
+    icInfo("Initializing NetworkCommissioning WiFi driver on endpoint %u", endpoint);
+    sLinuxWiFiDriver = new chip::DeviceLayer::NetworkCommissioning::LinuxWiFiDriver();
+    sNetworkCommissioningInstance = new chip::app::Clusters::NetworkCommissioning::Instance(endpoint, sLinuxWiFiDriver);
+    sNetworkCommissioningInstance->Init();
+}
-- 
2.43.0

